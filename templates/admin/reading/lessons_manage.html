{% extends "layout.html" %}
{% block title %}Reading — Admin{% endblock %}

{% block content %}
<div class="mx-auto max-w-7xl px-4 py-10">

  <!-- Header -->
  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-2xl font-semibold">Reading — Admin</h1>
    <div class="space-x-2">
      <a href="{{ url_for('admin_bp.new_lesson', subject='reading') }}"
         class="rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm hover:bg-slate-50">
        New lesson
      </a>
      <!-- FIXED endpoint name -->
      <a href="{{ url_for('admin_bp.reorder_lessons') }}"
         class="rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm hover:bg-slate-50">
        Reorder
      </a>
    </div>
  </div>

  <div class="mb-6 text-xs text-slate-500">
    Admin only • changes made here update the learner view immediately.
  </div>

  <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">

    <!-- Left: Manage list -->
    <section class="lg:col-span-1">
      <div class="rounded-2xl border border-slate-200 bg-white shadow">
        <div class="p-4 border-b font-medium">Manage</div>

        <div class="p-4 overflow-x-auto">
          {% if lessons %}
          <table class="min-w-full text-sm">
            <thead>
              <tr class="text-left text-slate-600">
                <th class="w-10 py-2 pr-3">#</th>
                <th class="py-2 pr-3">Title</th>
                <th class="py-2">Media</th>
              </tr>
            </thead>
            <tbody class="align-top">
              {% for l in lessons %}
              <tr class="border-t">
                <td class="py-2 pr-3 text-slate-500">{{ l.order }}</td>
                <td class="py-2 pr-3">
                  <div class="font-medium">{{ l.title }}</div>
                  {% if l.caption %}
                    <div class="text-xs text-slate-500">{{ l.caption }}</div>
                  {% endif %}
                </td>
                <td class="py-2 truncate">{{ l.video_filename or "—" }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
            <div class="text-sm text-slate-600">No lessons yet. Create your first lesson.</div>
          {% endif %}
        </div>

        <div class="p-4 border-t flex items-center justify-between">
          <a href="{{ url_for('admin_bp.new_lesson', subject='reading') }}"
             class="rounded-xl bg-sky-600 text-white px-3 py-2 text-sm hover:bg-sky-700">Add lesson</a>
          <!-- FIXED endpoint name -->
          <a href="{{ url_for('admin_bp.reorder_lessons') }}"
             class="rounded-xl border px-3 py-2 text-sm hover:bg-slate-50">Reorder</a>
        </div>
      </div>
    </section>

    <!-- Right: Admin-scoped learner preview -->
    <section class="lg:col-span-2">
      <div class="rounded-2xl border border-slate-200 bg-white shadow">
        <div class="px-4 py-3 border-b text-sm text-slate-600">
          Learner preview ({{ preview_ctx.get('learner_name', 'Learner') }})
        </div>
        <div class="p-4">
          {% with
            items = preview_ctx.get('items', []),
            learner_name = preview_ctx.get('learner_name', 'Learner'),
            user = preview_ctx.get('user', {'name': preview_ctx.get('learner_name', 'Learner')}),
            admin_preview = True
          %}
            {% include "school_reading/_lessons_table.html" %}
          {% endwith %}
        </div>
      </div>
    </section>

  </div>
</div>
{% endblock %}
