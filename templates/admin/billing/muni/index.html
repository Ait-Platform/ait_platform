{% extends "layout.html" %}
{% block content %}

<div class="container mx-auto py-10 space-y-6">

  <h1 class="text-2xl font-semibold">Municipal Accounts — Picker</h1>

  <!-- Actions toolbar (Search + Jump only) -->
  <div class="rounded-xl border p-4">
    <div class="flex flex-col md:flex-row md:items-end md:gap-6">

      <!-- Search (GET) -->
      <form method="get" class="flex items-end gap-2">
        <label class="text-sm">
          Search (account or owner)
          <input
            name="q"
            value="{{ q or '' }}"
            class="mt-1 border rounded-lg p-2 w-64"
            placeholder="e.g. 8332 or Nanhoo">
        </label>
        <button class="px-4 py-2 rounded-lg bg-black text-white">Search</button>
        <a href="{{ url_for('admin_bp.muni_accounts') }}" class="text-sm underline">Clear</a>
      </form>

      <!-- Jump to account (POST) -->
      <form method="post" action="{{ url_for('admin_bp.muni_accounts_go') }}" class="flex items-end gap-2">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <label class="text-sm">
          Jump to account
          <input
            name="account_number"
            list="accnums"
            class="mt-1 border rounded-lg p-2 w-56"
            placeholder="Start typing…"
            required>
        </label>
        <button class="px-4 py-2 rounded-lg bg-black text-white">Open Capture</button>
      </form>

    </div>
  </div>

  <!-- Datalist for Jump to account -->
  <datalist id="accnums">
    {% for n in all_nums %}
      <option value="{{ n }}"></option>
    {% endfor %}
  </datalist>

  <!-- Accounts table -->
  <div class="rounded-xl border overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-slate-50">
        <tr class="text-left">
          <th class="px-4 py-3">Account #</th>
          <th class="px-4 py-3">Owner</th>
          <th class="px-4 py-3">Water Meter</th>
          <th class="px-4 py-3">Elec Meter</th>
          <th class="px-4 py-3">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for a in accounts %}
          <tr class="border-t">
            <td class="px-4 py-2 font-mono">{{ a.account_number }}</td>
            <td class="px-4 py-2">{{ a.owner_name or '—' }}</td>
            <td class="px-4 py-2">{{ a.muni_water_meter_no or '—' }}</td>
            <td class="px-4 py-2">{{ a.muni_elec_meter_no or '—' }}</td>
            <td class="px-4 py-2">
              <a class="underline mr-3" href="{{ url_for('admin_bp.muni_capture', account_number=a.account_number) }}">Capture</a>
              <a class="underline" href="{{ url_for('admin_bp.muni_ledger', account_number=a.account_number) }}">Ledger</a>
            </td>
          </tr>
        {% else %}
          <tr class="border-t">
            <td class="px-4 py-6 text-center text-slate-500" colspan="5">No accounts found.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Footer -->
  <div>
    <a href="{{ url_for('admin_bp.subject_dashboard', subject='billing') }}" class="text-sm underline">
      Back to Billing
    </a>
  </div>

</div>

{% endblock %}
