{% extends "layout.html" %}
{% block title %}Special offer · AIT{% endblock %}

{% block content %}
<div class="mx-auto max-w-xl mt-10 bg-white p-6 rounded shadow">

  <!-- Resolve locked country from session -->
  {% set cc = session.get('pp_country') or 'ZA' %}
  {% set ns = namespace(name=cc) %}
  {% for c in countries %}
    {% if c.code == cc %}
      {% set ns.name = c.name %}
    {% endif %}
  {% endfor %}

  <!-- Header (no Back to About button) -->
    <!-- Header: discounted price -->
    <div class="flex items-center justify-between mb-2">
    <h2 class="text-base font-semibold text-slate-800">
        Discounted price
    </h2>
    <div class="text-xs font-medium text-amber-600">
        10% thank-you offer
    </div>
    </div>

    <p class="text-sm text-slate-600 mb-4">
    Sorry to see you go. As a thank you for exploring the Loss course,
    we’ve unlocked a <span class="font-semibold">10% discount</span> on your enrollment.
    </p>


  <!-- Locked country display -->
  <div class="mt-2">
    <label class="block text-sm font-medium">
      Country <span class="text-xs font-normal text-slate-400">(locked for this quote)</span>
    </label>
    <div class="mt-1 flex items-center justify-between rounded border px-3 py-2 text-sm bg-slate-50">
      <span>{{ ns.name }}</span>
      <span class="text-xs text-slate-500">{{ cc }}</span>
    </div>
    <p class="mt-1 text-xs text-slate-500">
      This country was selected on the pricing page. Changing country would require starting a new quote.
    </p>
  </div>

  <!-- Discounted price -->
  <div class="mt-4">
    <label class="block text-sm font-medium">Discounted price (your currency)</label>
    <div class="flex gap-2">
      <input type="text" readonly
             class="w-full rounded border px-3 py-2 text-sm bg-slate-50 text-right"
             value="{{ '%.2f' % ((session.get('pp_value') or 0) | float) }}">
      <span class="inline-flex items-center rounded border px-3 text-sm">
        {{ session.get('pp_currency') or 'ZAR' }}
      </span>
    </div>
    <p class="mt-1 text-xs text-emerald-600">
      10% discount already applied to the standard course price.
    </p>
  </div>

  <!-- Estimated ZAR charge -->
  <div class="mt-3">
    <label class="block text-sm font-medium">Estimated PayFast charge (in ZAR)</label>
    <div class="flex gap-2">
      <input type="text" readonly
             class="w-full rounded border px-3 py-2 text-sm bg-white text-right"
             value="{{ '%.2f' % ((session.get('pp_est_zar') or session.get('pp_value') or 0) | float) }}">
      <span class="inline-flex items-center rounded border px-3 text-sm">
        ZAR
      </span>
    </div>
    <p class="mt-1 text-xs text-slate-500">
      Based on an estimated rate of
      1 {{ session.get('pp_currency') or 'ZAR' }}
      ≈ {{ '%.2f' % ((session.get('pp_fx_rate') or 1) | float) }} ZAR.
      Your bank’s final rate may differ slightly.
    </p>
  </div>

  <!-- Actions: Cancel left, Enrol right -->
  <div class="mt-6 flex items-center justify-between">
    <a href="{{ url_for('public_bp.welcome') }}"
       class="rounded border px-4 py-2 text-sm hover:bg-slate-50">
      Cancel
    </a>

    <a href="{{ url_for('auth_bp.start_registration',
                        role='user',
                        subject=subject_slug,
                        subject_id=subject_id,
                        next=url_for('payfast_bp.checkout_review',
                                     subject_id=subject_id, subject=subject_slug)) }}"
       class="inline-flex items-center rounded bg-blue-600 px-4 py-2 text-white font-semibold hover:bg-blue-700">
      Enrol with 10% off
    </a>
  </div>

  {% if session.get('pp_currency') != 'ZAR' %}
    <div class="mt-3 text-xs text-slate-500 text-center">
      Charged in ZAR via PayFast • {{ session.get('pp_vat_note') or 'excl. VAT' }}
    </div>
  {% endif %}

</div>
{% endblock %}
