<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Redirecting…</title>
  </head>
  <body>

    {# Required PayFast fields we’ll send to our server route #}
    {% set fields = payload if payload is defined else {
      'amount': amount or '50.00',
      'item_name': name or 'Loss Course',
      'email': buyer_email or 'test@example.com',
      'm_payment_id': m_payment_id or ('AIT-' ~ (range(100000,999999)|random))
    } %}

    {# Post to our PayFast create endpoint (server signs + redirects to PayFast) #}
    <form id="handoff" method="post" action="{{ url_for('payfast_bp.create_payment') }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
      {% for k, v in fields.items() if v is not none and v != '' %}
        <input type="hidden" name="{{ k }}" value="{{ v }}">
      {% endfor %}
      <noscript>
        <p>Click continue to proceed to PayFast.</p>
        <button type="submit" class="btn btn-primary">Continue to PayFast</button>
        <a href="{{ back_url }}" class="btn btn-link">Back</a>
      </noscript>
    </form>

    <script>
      (function () { try { document.getElementById('handoff').submit(); } catch (e) {} })();
    </script>

  </body>
</html>
