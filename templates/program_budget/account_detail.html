{% extends "layout.html" %}
{% block title %}BudgetCash · Account{% endblock %}

{% block content %}
<div class="mx-auto max-w-4xl mt-10 bg-white shadow rounded-lg p-6">

  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-lg font-semibold text-slate-900">{{ account.name }}</h1>
      <div class="text-sm text-slate-500">{{ account.kind|title }}</div>
    </div>
    <a href="{{ url_for('budget_bp.ledger') }}"
       class="rounded border border-slate-300 px-3 py-1.5 hover:bg-slate-50 text-sm">
      ← Back to cashbook
    </a>
  </div>

  <!-- ACCOUNT SETTINGS (EDIT TYPE/NAME/GROUP) -->
  <div class="mt-6 rounded border border-slate-200 bg-slate-50/60 p-4">
    <div class="font-semibold text-slate-900">Account settings</div>
    <p class="text-xs text-slate-500 mt-1">Change the account name/type and grouping.</p>

    <form method="post" action="{{ url_for('budget_bp.account_meta_update', account_id=account.id) }}" class="mt-3">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <input type="hidden" name="next" value="{{ request.full_path }}">

      <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-end">
        <div class="md:col-span-2">
          <label class="block text-xs font-medium text-slate-600 mb-1">Account name</label>
          <input name="name" value="{{ account.name or '' }}"
                 class="w-full rounded border border-slate-300 px-3 py-2 text-sm">
        </div>

        <div>
          <label class="block text-xs font-medium text-slate-600 mb-1">Type</label>
          <select name="kind" class="w-full rounded border border-slate-300 px-3 py-2 text-sm">
            <option value="asset"    {% if account.kind == 'asset' %}selected{% endif %}>Asset</option>
            <option value="liability"{% if account.kind == 'liability' %}selected{% endif %}>Liability</option>
            <option value="expense"  {% if account.kind == 'expense' %}selected{% endif %}>Expense</option>
            <option value="income"   {% if account.kind == 'income' %}selected{% endif %}>Income</option>
          </select>
        </div>

        <div>
          <label class="block text-xs font-medium text-slate-600 mb-1">Group</label>
          <select name="group_label" class="w-full rounded border border-slate-300 px-3 py-2 text-sm">
            <option value="">—</option>
            {% for g in groups %}
              {% set label = g.label if g.label is defined else g['label'] %}
              <option value="{{ label }}" {% if (account.group_label or '') == label %}selected{% endif %}>
                {{ label }}
              </option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="mt-3">
        <label class="block text-xs font-medium text-slate-600 mb-1">Account number (optional)</label>
        <input name="account_no" value="{{ account.account_no or '' }}"
               class="w-full rounded border border-slate-300 px-3 py-2 text-sm">
      </div>

      <button class="mt-4 w-full rounded bg-slate-900 text-white px-4 py-2.5 text-sm font-medium hover:bg-slate-800">
        Save account settings
      </button>
    </form>
  </div>

  <!-- INPUT AREA (ABOVE) -->
  <div class="mt-6 rounded border border-slate-200 bg-slate-50/60 p-4">
    <div class="font-semibold text-slate-900">Statement snapshot (manual entry)</div>
    <p class="text-xs text-slate-500 mt-1">Enter what the statement says as at a specific date.</p>

    <form method="post" action="{{ url_for('budget_bp.ledger_account_update') }}" class="mt-3">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <input type="hidden" name="account_id" value="{{ account.id }}">
      <input type="hidden" name="next" value="{{ request.full_path }}">

      <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
        <div>
          <label class="block text-xs font-medium text-slate-600 mb-1">As at date</label>
          <input name="as_at" type="date"
                 value="{{ account.as_at if account.as_at else '' }}"
                 class="w-full rounded border border-slate-300 px-3 py-2 text-sm">
        </div>

        <div>
          <label class="block text-xs font-medium text-slate-600 mb-1">Arrears</label>
          <input name="arrears" inputmode="decimal"
                 value="{{ '%.2f'|format((account.arrears_cents|int)/100) }}"
                 class="w-full rounded border border-slate-300 px-3 py-2 text-sm">
        </div>

        <div>
          <label class="block text-xs font-medium text-slate-600 mb-1">Balance</label>
          <input name="balance" inputmode="decimal"
                 value="{{ '%.2f'|format((account.balance_cents|int)/100) }}"
                 class="w-full rounded border border-slate-300 px-3 py-2 text-sm">
        </div>

        <div>
          <label class="block text-xs font-medium text-slate-600 mb-1">Due</label>
          <input name="due" inputmode="decimal"
                 value="{{ '%.2f'|format((account.due_cents|int)/100) }}"
                 class="w-full rounded border border-slate-300 px-3 py-2 text-sm">
        </div>
      </div>

      <button class="mt-4 w-full rounded bg-sky-600 text-white px-4 py-2.5 text-sm font-medium hover:bg-sky-700">
        Save account details
      </button>
    </form>
  </div>

  <!-- OUTPUT AREA (BELOW) -->
  <div class="mt-6 grid grid-cols-1 md:grid-cols-5 gap-3">
    <div class="rounded border border-slate-200 p-3">
      <div class="text-xs text-slate-500">Paid (to date)</div>
      <div class="font-semibold text-slate-900">{{ '%.2f'|format(paid_total_cents/100) }}</div>
    </div>
    <div class="rounded border border-slate-200 p-3">
      <div class="text-xs text-slate-500">Arrears</div>
      <div class="font-semibold text-slate-900">{{ '%.2f'|format((account.arrears_cents|int)/100) }}</div>
    </div>
    <div class="rounded border border-slate-200 p-3">
      <div class="text-xs text-slate-500">Balance</div>
      <div class="font-semibold text-slate-900">{{ '%.2f'|format((account.balance_cents|int)/100) }}</div>
    </div>
    <div class="rounded border border-slate-200 p-3">
      <div class="text-xs text-slate-500">Due</div>
      <div class="font-semibold text-slate-900">{{ '%.2f'|format((account.due_cents|int)/100) }}</div>
    </div>
    <div class="rounded border border-slate-200 p-3">
      <div class="text-xs text-slate-500">As at</div>
      <div class="font-semibold text-slate-900">
        {% if account.as_at %}{{ account.as_at }}{% else %}—{% endif %}
      </div>
    </div>
  </div>

</div>
{% endblock %}
