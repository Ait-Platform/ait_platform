{% extends "layout.html" %}
{% block title %}Finance summary · SMS{% endblock %}

{% block content %}
<div class="mx-auto max-w-4xl mt-8 bg-white shadow rounded-lg p-6">
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-lg font-semibold text-slate-900">
      Finance summary – {{ year }}
    </h1>

    <a href="{{ url_for('sms_bp.finance_home') }}"
       class="text-xs text-indigo-600 hover:underline">
      ← Back
    </a>
        
    <form method="get" class="flex items-center gap-2 text-xs">
      <label>Year</label>
      <input type="number" name="year" value="{{ year }}"
             class="w-20 rounded-md border border-slate-300 px-2 py-1">
      <button class="rounded-md bg-slate-900 px-3 py-1 text-white">
        Go
      </button>
    </form>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-sm">
    <div class="rounded-md bg-emerald-50 border border-emerald-200 p-3">
      <div class="text-xs text-emerald-700">Total income</div>
      <div class="text-lg font-semibold text-emerald-900">
        R {{ '%.2f'|format((income_total or 0)/100) }}
      </div>
    </div>
    <div class="rounded-md bg-rose-50 border border-rose-200 p-3">
      <div class="text-xs text-rose-700">Total expenses</div>
      <div class="text-lg font-semibold text-rose-900">
        R {{ '%.2f'|format((expense_total or 0)/100) }}
      </div>
    </div>
    <div class="rounded-md bg-slate-50 border border-slate-200 p-3">
      <div class="text-xs text-slate-700">Surplus / deficit</div>
      <div class="text-lg font-semibold {% if surplus_cents >= 0 %}text-emerald-900{% else %}text-rose-900{% endif %}">
        R {{ '%.2f'|format((surplus_cents or 0)/100) }}
      </div>
    </div>
  </div>

  <h2 class="text-sm font-semibold text-slate-900 mb-2">By category</h2>
  {% if by_category %}
    <table class="min-w-full text-xs mb-6">
      <thead>
        <tr class="border-b border-slate-200 text-left text-slate-500">
          <th class="py-1 pr-2">Category</th>
          <th class="py-1 pr-2 text-right">Net (R)</th>
        </tr>
      </thead>
      <tbody>
        {% for name, cents in by_category.items() %}
          <tr class="border-b border-slate-100">
            <td class="py-1 pr-2">{{ name }}</td>
            <td class="py-1 pr-2 text-right">
              R {{ '%.2f'|format((cents or 0)/100) }}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-sm text-slate-500 mb-6">
      No transactions captured for this year.
    </p>
  {% endif %}

  <h2 class="text-sm font-semibold text-slate-900 mb-1">Fee planning helper</h2>
  <p class="text-xs text-slate-600 mb-2">
    Based on current year’s income and expenses.
  </p>
  <ul class="text-xs text-slate-700 mb-2">
    <li>Active learners: <strong>{{ expected_learners }}</strong></li>
  </ul>
  {% if required_fee_per_learner_cents is not none %}
    <p class="text-sm">
      Estimated <strong>minimum annual fee per learner</strong> to cover expenses,
      after other income (hall hire, subsidies, etc.):
      <strong>R {{ '%.2f'|format(required_fee_per_learner_cents/100) }}</strong>
    </p>
  {% else %}
    <p class="text-sm text-slate-500">
      Add learners and transactions to see a suggested fee per learner.
    </p>
  {% endif %}
</div>
{% endblock %}
