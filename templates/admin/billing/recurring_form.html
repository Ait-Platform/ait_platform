{% extends "layout.html" %}
{% block content %}
<div class="container mx-auto max-w-lg py-8">
  <h1 class="text-xl font-semibold mb-4">
    {{ 'New Recurring Item' if mode == 'new' else 'Edit Recurring Item' }}
  </h1>

  <form method="post" class="space-y-4">
    {% if csrf_token is defined %}
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    {% elif request and request.cookies.get('csrf_token') %}
      <input type="hidden" name="csrf_token" value="{{ request.cookies.get('csrf_token') }}">
    {% endif %}

    <input type="hidden" name="tenant_id" value="{{ tenant_id }}">
    {% if month %}<input type="hidden" name="month" value="{{ month }}">{% endif %}

    <div>
      <label class="block text-sm mb-1">Description</label>
      <input type="text" name="description"
             value="{{ rec.description if rec else 'Rent' }}"
             class="w-full border rounded-lg px-3 py-2" required>
    </div>

    <div>
      <label class="block text-sm mb-1">Kind</label>
      <select name="kind" class="w-full border rounded-lg px-3 py-2">
        {% set k = (rec.kind if rec else 'charge') %}
        <option value="charge"  {{ 'selected' if k=='charge'  else '' }}>Charge (debit)</option>
        <option value="payment" {{ 'selected' if k=='payment' else '' }}>Payment (credit)</option>
      </select>
    </div>

    <div>
      <label class="block text-sm mb-1">Amount</label>
      <input type="number" step="0.01" min="0.01" name="amount"
             value="{{ rec.amount if rec else '' }}"
             class="w-full border rounded-lg px-3 py-2" required>
      <p class="text-xs text-slate-500 mt-1">Payments will be saved as negative amounts.</p>
    </div>

    <div>
      <label class="block text-sm mb-1">Day of Month (1â€“28)</label>
      <input type="number" name="day_of_month" min="1" max="28"
             value="{{ rec.day_of_month if rec else 1 }}"
             class="w-full border rounded-lg px-3 py-2" required>
    </div>

    <div class="grid grid-cols-2 gap-3">
      <div>
        <label class="block text-sm mb-1">Start Month (YYYY-MM)</label>
        <input type="month" name="start_month"
               value="{{ rec.start_month if rec else '' }}"
               class="w-full border rounded-lg px-3 py-2">
      </div>
      <div>
        <label class="block text-sm mb-1">End Month (YYYY-MM)</label>
        <input type="month" name="end_month"
               value="{{ rec.end_month if rec else '' }}"
               class="w-full border rounded-lg px-3 py-2">
      </div>
    </div>

    <div class="flex gap-2">
      <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg">
        {{ 'Create' if mode=='new' else 'Save' }}
      </button>
      <a href="{{ url_for('admin_bp.recurring_index', tenant_id=tenant_id, month=month or '') }}"
         class="px-4 py-2 rounded-lg border">Cancel</a>
    </div>
  </form>
</div>
{% endblock %}
