{# templates/payments/pricing.html #}
{% extends "layout.html" %}
{% block title %}Price · AIT{% endblock %}

{% block content %}
<div class="mx-auto max-w-xl mt-10 bg-white p-6 rounded shadow">

  <!-- Top bar -->
  <div class="flex items-center justify-between mb-4">
    <a href="{{ url_for('loss_bp.about_loss', subject=subject_slug) }}"
       class="rounded border px-3 py-1.5 text-sm hover:bg-slate-50">
      ← Back
    </a>
    <div class="text-xs text-slate-500">
      Value-based parity pricing
    </div>
  </div>

  <h1 class="text-lg font-semibold mb-4">Parity price</h1>

  {# SINGLE form: country + lock button #}
  <form method="POST"
        action="{{ url_for('payfast_bp.pricing_lock', subject=subject_slug) }}"
        class="space-y-4">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <!-- Country -->
    <div>
      <label class="block text-sm font-medium">
        Country
        <span class="text-xs text-slate-400">(please select your country)</span>
      </label>
      <select name="country"
              class="mt-1 block w-full rounded border px-3 py-2 text-sm bg-white">
        <option value="">Select your country</option>
        {% for c in countries %}
          <option value="{{ c.code }}"
                  {% if price.country_code == c.code %}selected{% endif %}>
            {{ c.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Price (local) -->
    <div>
      <label class="block text-sm font-medium">Price (your currency)</label>
      <div class="flex gap-2">
        <input type="text" readonly
               class="w-full rounded border px-3 py-2 text-sm bg-slate-50 text-right"
               value="{% if price.has_quote and price.local_amount is not none %}{{ '%.2f' % price.local_amount }}{% endif %}">
        <span class="inline-flex items-center rounded border px-3 text-sm">
          {{ price.local_currency or '—' }}
        </span>
      </div>
    </div>

    <!-- Estimated ZAR charge -->
    <div>
      <label class="block text-sm font-medium">Estimated PayFast charge (in ZAR)</label>
      <div class="flex gap-2">
        <input type="text" readonly
               class="w-full rounded border px-3 py-2 text-sm bg-slate-50 text-right"
               value="{% if price.has_quote and price.estimated_zar is not none %}{{ '%.2f' % price.estimated_zar }}{% endif %}">
        <span class="inline-flex items-center rounded border px-3 text-sm">ZAR</span>
      </div>
      <p class="mt-1 text-xs text-slate-500">
        {% if price.has_quote and price.fx_rate %}
          Based on an estimated rate of
          1 {{ price.local_currency or 'ZAR' }} ≈ {{ '%.4f' % price.fx_rate }} ZAR.
          Your bank’s final rate may differ slightly.
        {% else %}
          The exact ZAR amount will be shown once your country is selected.
        {% endif %}
      </p>
    </div>

    <!-- Buttons -->
    <div class="mt-4 flex items-center justify-between">
      <a href="{{ url_for('loss_bp.about_loss', subject=subject_slug) }}"
         class="rounded border px-4 py-2 text-sm hover:bg-slate-50">
        ← Back
      </a>

      <button type="submit"
              class="rounded bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-700">
        Lock my price
      </button>
    </div>
  </form>

  <!-- Note box -->
  <div class="mt-6 rounded-lg border bg-slate-50 px-4 py-3 text-sm text-slate-700">
    <p class="font-semibold mb-1">About our value-based pricing</p>
    <ul class="list-disc list-inside space-y-1">
      <li>You’ll see a locked price in your country’s currency for clarity.</li>
      <li>Payment is processed in ZAR via PayFast. The ZAR amount above is our best estimate based on reference rates.</li>
      <li>Prices are exclusive of VAT unless stated otherwise; any applicable taxes are shown before you pay.</li>
      <li>Refunds are issued in ZAR for the ZAR amount charged; your bank’s exchange rate may differ.</li>
    </ul>
  </div>

</div>
{% endblock %}
