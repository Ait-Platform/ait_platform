{% extends "layout.html" %}
{% block title %}Reading · AIT{% endblock %}

{% block content %}
<div class="mx-auto max-w-5xl mt-8 space-y-6">

  <div class="flex items-center justify-between">
    <a href="{{ url_for('auth_bp.bridge_dashboard') }}"
       class="inline-flex items-center rounded border border-slate-300 px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50">
      ← Back to dashboard
    </a>
    <div class="text-sm font-semibold text-slate-900">Reading</div>
  </div>

  <div class="grid gap-4 sm:grid-cols-3">

    {# 1) View lessons #}
    <a href="{{ url_for('reading_bp.learner_dashboard') }}"
       class="block rounded-lg border border-slate-200 bg-white p-5 shadow hover:bg-slate-50">
      <div class="text-sm font-semibold text-slate-900">View lessons</div>
      <div class="mt-1 text-xs text-slate-600">Open your lessons and watch the videos.</div>
    </a>

    {# 2) Progress #}
    <div class="block rounded-lg border border-slate-200 bg-white p-5 shadow">
      <div class="text-sm font-semibold text-slate-900">Progress</div>

      <div class="mt-3 h-2 w-full rounded bg-slate-200 overflow-hidden">
        <div id="progressFill"
            class="h-2 rounded bg-emerald-600"
            data-pct="{{ progress_percent|default(0)|int }}"></div>
      </div>

      <div class="mt-2 text-xs text-slate-600">
        {{ progress_percent|default(0)|int }}% complete ({{ completed|default(0) }}/{{ total|default(0) }})
      </div>
    </div>

    <script>
      (function () {
        const el = document.getElementById("progressFill");
        if (!el) return;
        const pct = Math.max(0, Math.min(100, parseInt(el.dataset.pct || "0", 10)));
        el.style.width = pct + "%";
      })();
    </script>

    {# 3) Certificate / Finish #}
    {% set can_finish = (progress_percent|default(0)|int) >= 100 %}

    {% if can_finish %}
      <div class="block rounded-lg border border-slate-200 bg-white p-5 shadow">
        <div class="text-sm font-semibold text-slate-900">Certificate</div>
        <div class="mt-1 text-xs text-slate-600">Finish the course to issue your PDF certificate.</div>

        <form method="POST" action="{{ url_for('reading_bp.finish_course') }}" class="mt-3">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button type="submit"
                  class="inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-xs font-semibold text-white hover:bg-indigo-700">
            ✓ Finish course & issue certificate
          </button>
        </form>

        {% if enrollment_status == 'completed' %}
          <a href="{{ url_for('reading_bp.get_certificate') }}"
            class="mt-3 inline-flex items-center text-xs font-semibold text-indigo-700 hover:underline">
            Download certificate
          </a>
        {% endif %}
      </div>
    {% else %}
      <div class="block rounded-lg border border-slate-200 bg-white p-5 shadow opacity-60">
        <div class="text-sm font-semibold text-slate-900">Certificate</div>
        <div class="mt-1 text-xs text-slate-600">Finish all lessons to unlock.</div>
      </div>
    {% endif %}


  </div>

</div>
{% endblock %}
